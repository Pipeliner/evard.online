
<html>
<head>

  <meta http-equiv="Content-Type" content="text/html; charset=US-ASCII" />
  <title>mon-info.h</title>

  <link rel="stylesheet" href="../style.css"/>
  <script src="../jquery-3.2.1.min.js"></script>
</head>
<body>

<pre><code class = "cpp">
<a name="ln1">#pragma once</a>
<a name="ln2"> </a>
<a name="ln3">#include &lt;functional&gt;</a>
<a name="ln4"> </a>
<a name="ln5">#include &quot;enchant-type.h&quot;</a>
<a name="ln6">#include &quot;mon-util.h&quot;</a>
<a name="ln7"> </a>
<a name="ln8">#define SPECIAL_WEAPON_KEY &quot;special_weapon_name&quot;</a>
<a name="ln9">#define CLOUD_IMMUNE_MB_KEY &quot;cloud_immune&quot;</a>
<a name="ln10"> </a>
<a name="ln11">enum monster_info_flags</a>
<a name="ln12">{</a>
<a name="ln13">    MB_STABBABLE,</a>
<a name="ln14">    MB_DISTRACTED,</a>
<a name="ln15">    MB_BERSERK,</a>
<a name="ln16">    MB_DORMANT,</a>
<a name="ln17">    MB_SLEEPING,</a>
<a name="ln18">    MB_UNAWARE,</a>
<a name="ln19">    MB_WANDERING,</a>
<a name="ln20">    MB_HASTED,</a>
<a name="ln21">    MB_STRONG,</a>
<a name="ln22">    MB_SLOWED,</a>
<a name="ln23">    MB_FLEEING,</a>
<a name="ln24">    MB_CONFUSED,</a>
<a name="ln25">    MB_INVISIBLE,</a>
<a name="ln26">    MB_POISONED,</a>
<a name="ln27">    MB_MORE_POISONED,</a>
<a name="ln28">    MB_MAX_POISONED,</a>
<a name="ln29">#if TAG_MAJOR_VERSION == 34</a>
<a name="ln30">    MB_ROTTING,</a>
<a name="ln31">#endif</a>
<a name="ln32">    MB_SUMMONED,</a>
<a name="ln33">    MB_HALOED,</a>
<a name="ln34">    MB_GLOWING,</a>
<a name="ln35">    MB_CHARMED,</a>
<a name="ln36">    MB_BURNING,</a>
<a name="ln37">    MB_PARALYSED,</a>
<a name="ln38">    MB_SICK,</a>
<a name="ln39">    MB_CAUGHT,</a>
<a name="ln40">    MB_WEBBED,</a>
<a name="ln41">#if TAG_MAJOR_VERSION == 34</a>
<a name="ln42">    MB_OLD_FRENZIED,</a>
<a name="ln43">#endif</a>
<a name="ln44">    MB_PETRIFYING,</a>
<a name="ln45">    MB_PETRIFIED,</a>
<a name="ln46">    MB_VULN_MAGIC,</a>
<a name="ln47">    MB_POSSESSABLE,</a>
<a name="ln48">    MB_ENSLAVED,</a>
<a name="ln49">    MB_SWIFT,</a>
<a name="ln50">    MB_INSANE,</a>
<a name="ln51">    MB_SILENCING,</a>
<a name="ln52">    MB_MESMERIZING,</a>
<a name="ln53">#if TAG_MAJOR_VERSION == 34</a>
<a name="ln54">    MB_EVIL_ATTACK,</a>
<a name="ln55">#endif</a>
<a name="ln56">    MB_SHAPESHIFTER,</a>
<a name="ln57">    MB_CHAOTIC,</a>
<a name="ln58">    MB_SUBMERGED,</a>
<a name="ln59">#if TAG_MAJOR_VERSION == 34</a>
<a name="ln60">    MB_BLEEDING,</a>
<a name="ln61">#endif</a>
<a name="ln62">#if TAG_MAJOR_VERSION == 34</a>
<a name="ln63">    MB_PREP_RESURRECT,</a>
<a name="ln64">#endif</a>
<a name="ln65">    MB_REGENERATION,</a>
<a name="ln66">    MB_RAISED_MR,</a>
<a name="ln67">    MB_MIRROR_DAMAGE,</a>
<a name="ln68">    MB_SAFE,</a>
<a name="ln69">    MB_UNSAFE,</a>
<a name="ln70">    MB_NAME_SUFFIX, // [art] rat foo does...</a>
<a name="ln71">    MB_NAME_ADJECTIVE, // [art] foo rat does...</a>
<a name="ln72">    MB_NAME_REPLACE, // [art] foo does</a>
<a name="ln73">    MB_NAME_UNQUALIFIED, // Foo does...</a>
<a name="ln74">    MB_NAME_THE, // The foo does....</a>
<a name="ln75">#if TAG_MAJOR_VERSION == 34</a>
<a name="ln76">    MB_FADING_AWAY,</a>
<a name="ln77">    MB_MOSTLY_FADED,</a>
<a name="ln78">#endif</a>
<a name="ln79">    MB_FEAR_INSPIRING,</a>
<a name="ln80">#if TAG_MAJOR_VERSION == 34</a>
<a name="ln81">    MB_WITHDRAWN,</a>
<a name="ln82">    MB_ATTACHED,</a>
<a name="ln83">#endif</a>
<a name="ln84">    MB_DAZED,</a>
<a name="ln85">    MB_MUTE,</a>
<a name="ln86">    MB_BLIND,</a>
<a name="ln87">    MB_DUMB,</a>
<a name="ln88">    MB_MAD,</a>
<a name="ln89">#if TAG_MAJOR_VERSION == 34</a>
<a name="ln90">    MB_CLINGING,</a>
<a name="ln91">#endif</a>
<a name="ln92">    MB_NAME_ZOMBIE,</a>
<a name="ln93">    MB_PERM_SUMMON,</a>
<a name="ln94">    MB_INNER_FLAME,</a>
<a name="ln95">    MB_UMBRAED,</a>
<a name="ln96">#if TAG_MAJOR_VERSION == 34</a>
<a name="ln97">    MB_OLD_ROUSED,</a>
<a name="ln98">#endif</a>
<a name="ln99">    MB_BREATH_WEAPON,</a>
<a name="ln100">#if TAG_MAJOR_VERSION == 34</a>
<a name="ln101">    MB_DEATHS_DOOR,</a>
<a name="ln102">#endif</a>
<a name="ln103">    MB_FIREWOOD,</a>
<a name="ln104">    MB_TWO_WEAPONS,</a>
<a name="ln105">    MB_NO_REGEN,</a>
<a name="ln106">#if TAG_MAJOR_VERSION == 34</a>
<a name="ln107">    MB_SUPPRESSED,</a>
<a name="ln108">    MB_ROLLING,</a>
<a name="ln109">#endif</a>
<a name="ln110">    MB_RANGED_ATTACK,</a>
<a name="ln111">    MB_NO_NAME_TAG,</a>
<a name="ln112">    MB_OZOCUBUS_ARMOUR,</a>
<a name="ln113">#if TAG_MAJOR_VERSION == 34</a>
<a name="ln114">    MB_MAGIC_ARMOUR,</a>
<a name="ln115">#endif</a>
<a name="ln116">    MB_WRETCHED,</a>
<a name="ln117">    MB_SCREAMED,</a>
<a name="ln118">    MB_WORD_OF_RECALL,</a>
<a name="ln119">    MB_INJURY_BOND,</a>
<a name="ln120">    MB_WATER_HOLD,</a>
<a name="ln121">    MB_WATER_HOLD_DROWN,</a>
<a name="ln122">    MB_FLAYED,</a>
<a name="ln123">#if TAG_MAJOR_VERSION == 34</a>
<a name="ln124">    MB_RETCHING,</a>
<a name="ln125">#endif</a>
<a name="ln126">    MB_WEAK,</a>
<a name="ln127">    MB_DIMENSION_ANCHOR,</a>
<a name="ln128">#if TAG_MAJOR_VERSION == 34</a>
<a name="ln129">    MB_CONTROL_WINDS,</a>
<a name="ln130">    MB_WIND_AIDED,</a>
<a name="ln131">    MB_SUMMONED_NO_STAIRS, // Temp. summoned and capped monsters</a>
<a name="ln132">#endif</a>
<a name="ln133">    MB_SUMMONED_CAPPED,    // Expiring due to summons cap</a>
<a name="ln134">    MB_TOXIC_RADIANCE,</a>
<a name="ln135">    MB_GRASPING_ROOTS,</a>
<a name="ln136">    MB_FIRE_VULN,</a>
<a name="ln137">    MB_TORNADO,</a>
<a name="ln138">    MB_TORNADO_COOLDOWN,</a>
<a name="ln139">    MB_BARBS,</a>
<a name="ln140">    MB_POISON_VULN,</a>
<a name="ln141">    MB_ICEMAIL,</a>
<a name="ln142">    MB_AGILE,</a>
<a name="ln143">    MB_FROZEN,</a>
<a name="ln144">    MB_BLACK_MARK,</a>
<a name="ln145">    MB_SAP_MAGIC,</a>
<a name="ln146">    MB_SHROUD,</a>
<a name="ln147">    MB_CORROSION,</a>
<a name="ln148">    MB_SPECTRALISED,</a>
<a name="ln149">    MB_SLOW_MOVEMENT,</a>
<a name="ln150">    MB_LIGHTLY_DRAINED,</a>
<a name="ln151">    MB_HEAVILY_DRAINED,</a>
<a name="ln152">    MB_REPEL_MSL,</a>
<a name="ln153">#if TAG_MAJOR_VERSION == 34</a>
<a name="ln154">    MB_NEGATIVE_VULN,</a>
<a name="ln155">    MB_CONDENSATION_SHIELD,</a>
<a name="ln156">#endif</a>
<a name="ln157">    MB_RESISTANCE,</a>
<a name="ln158">    MB_HEXED,</a>
<a name="ln159">#if TAG_MAJOR_VERSION == 34</a>
<a name="ln160">    MB_BONE_ARMOUR,</a>
<a name="ln161">    MB_CHANT_FIRE_STORM,</a>
<a name="ln162">    MB_CHANT_WORD_OF_ENTROPY,</a>
<a name="ln163">#endif</a>
<a name="ln164">    MB_AIRBORNE,</a>
<a name="ln165">    MB_BRILLIANCE_AURA,</a>
<a name="ln166">    MB_EMPOWERED_SPELLS,</a>
<a name="ln167">    MB_READY_TO_HOWL,</a>
<a name="ln168">    MB_PARTIALLY_CHARGED,</a>
<a name="ln169">    MB_FULLY_CHARGED,</a>
<a name="ln170">    MB_GOZAG_INCITED,</a>
<a name="ln171">    MB_PAIN_BOND,</a>
<a name="ln172">    MB_IDEALISED,</a>
<a name="ln173">    MB_BOUND_SOUL,</a>
<a name="ln174">    MB_INFESTATION,</a>
<a name="ln175">    MB_NO_REWARD,</a>
<a name="ln176">    MB_STILL_WINDS,</a>
<a name="ln177">    MB_SLOWLY_DYING,</a>
<a name="ln178">#if TAG_MAJOR_VERSION == 34</a>
<a name="ln179">    MB_PINNED,</a>
<a name="ln180">#endif</a>
<a name="ln181">    MB_VILE_CLUTCH,</a>
<a name="ln182">    MB_HIGHLIGHTED_SUMMONER,</a>
<a name="ln183">    MB_WATERLOGGED,</a>
<a name="ln184">    NUM_MB_FLAGS</a>
<a name="ln185">};</a>
<a name="ln186"> </a>
<a name="ln187">struct monster_info_base</a>
<a name="ln188">{</a>
<a name="ln189">    coord_def pos;</a>
<a name="ln190">    FixedBitVector&lt;NUM_MB_FLAGS&gt; mb;</a>
<a name="ln191">    string mname;</a>
<a name="ln192">    monster_type type;</a>
<a name="ln193">    monster_type base_type;</a>
<a name="ln194">    union</a>
<a name="ln195">    {</a>
<a name="ln196">        // These must all be the same size!</a>
<a name="ln197">        unsigned number; ///&lt; General purpose number variable</a>
<a name="ln198">        int num_heads;   ///&lt; # of hydra heads</a>
<a name="ln199">        int slime_size;  ///&lt; # of slimes in this one</a>
<a name="ln200">        int is_active;   ///&lt; Whether this ballisto is active or not</a>
<a name="ln201">    };</a>
<a name="ln202">    int _colour;</a>
<a name="ln203">    mon_attitude_type attitude;</a>
<a name="ln204">    mon_threat_level_type threat;</a>
<a name="ln205">    mon_dam_level_type dam;</a>
<a name="ln206">    // TODO: maybe we should store the position instead</a>
<a name="ln207">    dungeon_feature_type fire_blocker;</a>
<a name="ln208">    string description;</a>
<a name="ln209">    string quote;</a>
<a name="ln210">    mon_holy_type holi;</a>
<a name="ln211">    mon_intel_type mintel;</a>
<a name="ln212">    int hd;</a>
<a name="ln213">    int ac;</a>
<a name="ln214">    int ev;</a>
<a name="ln215">    int base_ev;</a>
<a name="ln216">    int mr;</a>
<a name="ln217">    resists_t mresists;</a>
<a name="ln218">    bool can_see_invis;</a>
<a name="ln219">    mon_itemuse_type mitemuse;</a>
<a name="ln220">    int mbase_speed;</a>
<a name="ln221">    mon_energy_usage menergy;</a>
<a name="ln222">    CrawlHashTable props;</a>
<a name="ln223">    string constrictor_name;</a>
<a name="ln224">    vector&lt;string&gt; constricting_name;</a>
<a name="ln225">    monster_spells spells;</a>
<a name="ln226">    mon_attack_def attack[MAX_NUM_ATTACKS];</a>
<a name="ln227">    bool can_go_frenzy;</a>
<a name="ln228"> </a>
<a name="ln229">    uint32_t client_id;</a>
<a name="ln230">};</a>
<a name="ln231"> </a>
<a name="ln232">// Monster info used by the pane; precomputes some data</a>
<a name="ln233">// to help with sorting and rendering.</a>
<a name="ln234">struct monster_info : public monster_info_base</a>
<a name="ln235">{</a>
<a name="ln236">    static bool less_than(const monster_info&amp; m1,</a>
<a name="ln237">                          const monster_info&amp; m2, bool zombified = true,</a>
<a name="ln238">                          bool fullname = true);</a>
<a name="ln239"> </a>
<a name="ln240">    static bool less_than_wrapper(const monster_info&amp; m1,</a>
<a name="ln241">                                  const monster_info&amp; m2);</a>
<a name="ln242"> </a>
<a name="ln243">#define MILEV_ALL 0</a>
<a name="ln244">#define MILEV_SKIP_SAFE -1</a>
<a name="ln245">#define MILEV_NAME -2</a>
<a name="ln246">    monster_info() { client_id = 0; }</a>
<a name="ln247">    explicit monster_info(const monster* m, int level = MILEV_ALL);</a>
<a name="ln248">    explicit monster_info(monster_type p_type,</a>
<a name="ln249">                          monster_type p_base_type = MONS_NO_MONSTER);</a>
<a name="ln250"> </a>
<a name="ln251">    monster_info(const monster_info&amp; mi)</a>
<a name="ln252">    : monster_info_base(mi), i_ghost(mi.i_ghost)</a>
<a name="ln253">    {</a>
<a name="ln254">        for (unsigned i = 0; i &lt;= MSLOT_LAST_VISIBLE_SLOT; ++i)</a>
<a name="ln255">        {</a>
<a name="ln256">            if (mi.inv[i])</a>
<a name="ln257">                inv[i].reset(new item_def(*mi.inv[i]));</a>
<a name="ln258">        }</a>
<a name="ln259">    }</a>
<a name="ln260"> </a>
<a name="ln261">    monster_info&amp; operator=(const monster_info&amp; p)</a>
<a name="ln262">    {</a>
<a name="ln263">        if (this != &amp;p)</a>
<a name="ln264">        {</a>
<a name="ln265">            this-&gt;~monster_info();</a>
<a name="ln266">            new (this) monster_info(p);</a>
<a name="ln267">        }</a>
<a name="ln268">        return *this;</a>
<a name="ln269">    }</a>
<a name="ln270"> </a>
<a name="ln271">    void to_string(int count, string&amp; desc, int&amp; desc_colour,</a>
<a name="ln272">                   bool fullname = true, const char *adjective = nullptr) const;</a>
<a name="ln273"> </a>
<a name="ln274">    /* only real equipment is visible, miscellany is for mimic items */</a>
<a name="ln275">    unique_ptr&lt;item_def&gt; inv[MSLOT_LAST_VISIBLE_SLOT + 1];</a>
<a name="ln276"> </a>
<a name="ln277">    struct</a>
<a name="ln278">    {</a>
<a name="ln279">        species_type species;</a>
<a name="ln280">        job_type job;</a>
<a name="ln281">        god_type religion;</a>
<a name="ln282">        skill_type best_skill;</a>
<a name="ln283">        short best_skill_rank;</a>
<a name="ln284">        short xl_rank;</a>
<a name="ln285">        short damage;</a>
<a name="ln286">        short ac;</a>
<a name="ln287">    } i_ghost;</a>
<a name="ln288"> </a>
<a name="ln289">    inline bool is(unsigned mbflag) const</a>
<a name="ln290">    {</a>
<a name="ln291">        return mb[mbflag];</a>
<a name="ln292">    }</a>
<a name="ln293"> </a>
<a name="ln294">    inline string damage_desc() const</a>
<a name="ln295">    {</a>
<a name="ln296">        return get_damage_level_string(holi, dam);</a>
<a name="ln297">    }</a>
<a name="ln298">    string get_max_hp_desc() const;</a>
<a name="ln299"> </a>
<a name="ln300">    inline bool neutral() const</a>
<a name="ln301">    {</a>
<a name="ln302">        return attitude == ATT_NEUTRAL || attitude == ATT_GOOD_NEUTRAL || attitude == ATT_STRICT_NEUTRAL;</a>
<a name="ln303">    }</a>
<a name="ln304"> </a>
<a name="ln305">    string db_name() const;</a>
<a name="ln306">    bool has_proper_name() const;</a>
<a name="ln307">    string pluralised_name(bool fullname = true) const;</a>
<a name="ln308">    string common_name(description_level_type desc = DESC_PLAIN) const;</a>
<a name="ln309">    string proper_name(description_level_type desc = DESC_PLAIN) const;</a>
<a name="ln310">    string full_name(description_level_type desc = DESC_PLAIN) const;</a>
<a name="ln311"> </a>
<a name="ln312">    vector&lt;string&gt; attributes() const;</a>
<a name="ln313"> </a>
<a name="ln314">    const char *pronoun(pronoun_type variant) const;</a>
<a name="ln315">    bool pronoun_plurality() const;</a>
<a name="ln316"> </a>
<a name="ln317">    string wounds_description_sentence() const;</a>
<a name="ln318">    string wounds_description(bool colour = false) const;</a>
<a name="ln319"> </a>
<a name="ln320">    string constriction_description() const;</a>
<a name="ln321"> </a>
<a name="ln322">    monster_type draco_or_demonspawn_subspecies() const;</a>
<a name="ln323"> </a>
<a name="ln324">    mon_intel_type intel() const</a>
<a name="ln325">    {</a>
<a name="ln326">        return mintel;</a>
<a name="ln327">    }</a>
<a name="ln328"> </a>
<a name="ln329">    resists_t resists() const</a>
<a name="ln330">    {</a>
<a name="ln331">        return mresists;</a>
<a name="ln332">    }</a>
<a name="ln333"> </a>
<a name="ln334">    mon_itemuse_type itemuse() const</a>
<a name="ln335">    {</a>
<a name="ln336">        return mitemuse;</a>
<a name="ln337">    }</a>
<a name="ln338"> </a>
<a name="ln339">    int randarts(artefact_prop_type ra_prop) const;</a>
<a name="ln340">    bool can_see_invisible() const;</a>
<a name="ln341">    int res_magic() const;</a>
<a name="ln342"> </a>
<a name="ln343">    int base_speed() const</a>
<a name="ln344">    {</a>
<a name="ln345">        return mbase_speed;</a>
<a name="ln346">    }</a>
<a name="ln347"> </a>
<a name="ln348">    string speed_description() const;</a>
<a name="ln349"> </a>
<a name="ln350">    bool wields_two_weapons() const;</a>
<a name="ln351">    bool can_regenerate() const;</a>
<a name="ln352">    reach_type reach_range() const;</a>
<a name="ln353"> </a>
<a name="ln354">    size_type body_size() const;</a>
<a name="ln355"> </a>
<a name="ln356">    // These should be kept in sync with the actor equivalents</a>
<a name="ln357">    // (Maybe unify somehow?)</a>
<a name="ln358">    bool cannot_move() const;</a>
<a name="ln359">    bool airborne() const;</a>
<a name="ln360">    bool ground_level() const;</a>
<a name="ln361"> </a>
<a name="ln362">    bool is_named() const</a>
<a name="ln363">    {</a>
<a name="ln364">        return !mname.empty() || mons_is_unique(type);</a>
<a name="ln365">    }</a>
<a name="ln366"> </a>
<a name="ln367">    bool is_actual_spellcaster() const</a>
<a name="ln368">    {</a>
<a name="ln369">        return props.exists(&quot;actual_spellcaster&quot;);</a>
<a name="ln370">    }</a>
<a name="ln371"> </a>
<a name="ln372">    bool is_priest() const</a>
<a name="ln373">    {</a>
<a name="ln374">        return props.exists(&quot;priest&quot;);</a>
<a name="ln375">    }</a>
<a name="ln376"> </a>
<a name="ln377">    bool has_spells() const;</a>
<a name="ln378">    int spell_hd(spell_type spell = SPELL_NO_SPELL) const;</a>
<a name="ln379">    unsigned colour(bool base_colour = false) const;</a>
<a name="ln380">    void set_colour(int colour);</a>
<a name="ln381"> </a>
<a name="ln382">    bool has_trivial_ench(enchant_type ench) const;</a>
<a name="ln383">    bool debuffable() const;</a>
<a name="ln384"> </a>
<a name="ln385">protected:</a>
<a name="ln386">    string _core_name() const;</a>
<a name="ln387">    string _base_name() const;</a>
<a name="ln388">    string _apply_adjusted_description(description_level_type desc, const string&amp; s) const;</a>
<a name="ln389">};</a>
<a name="ln390"> </a>
<a name="ln391">// Colour should be between -1 and 15 inclusive!</a>
<a name="ln392">bool set_monster_list_colour(string key, int colour);</a>
<a name="ln393">void clear_monster_list_colours();</a>
<a name="ln394"> </a>
<a name="ln395">void get_monster_info(vector&lt;monster_info&gt;&amp; mons);</a>
<a name="ln396"> </a>
<a name="ln397">typedef function&lt;vector&lt;string&gt; (const monster_info&amp; mi)&gt; (desc_filter);</a>

</code></pre>
<div class="balloon" rel="246"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v730/" target="_blank">V730</a> Not all members of a class are initialized inside the constructor. Consider inspecting: i_ghost.</p></div>

<link rel="stylesheet" href="highlight.css">
<script src="highlight.pack.js"></script>
<script src="highlightjs-line-numbers.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>hljs.initLineNumbersOnLoad();</script>
<script>
  $(document).ready(function() {
      $('.balloon').each(function () {
          var bl = $(this);
          var line = bl.attr('rel');
          var text = $('a[name="ln'+line+'"]').text();

          var space_count = 0;
          for(var i = 0; i<text.length; i++){
              var char = text[i];
              if((char !== ' ')&&(char !== '\t'))break;
              if(char === '\t')space_count++;
              space_count++;
          }

          bl.css('margin-left', space_count*8);
          $('a[name="ln'+line+'"]').after(bl);
      });

      window.location = window.location;
  });
</script>
</body>
</html>
